\documentclass[gradu, twoside]{tktltiki}
\usepackage{amsmath}
\begin{document}

\title{Vakaan avioliiton ongelman ja sen muunnelmien aikavaativuuksia}
\author{Jani Rahkola}
\date{\today}
\level{}

\maketitle

\doublespacing

\faculty{Matemaattis-luonnontieteellinen}
\department{Tietojenkäsittelytieteen laitos}
\subject{Tietojenkäsittelytiede}

\begin{abstract}
  Vakaan avioliiton ongelmassa miesten joukon $M$ ja naisten joukon
  $N$ välille pyritään löytämään relaatio $\mu \subset M \times N$
  noudattaen miesten ja naisten mieltymyksiä kuvaavia
  järjestysrelaatioita $P_M = \{P_a \subset N \times N | a \in M\}$ ja
  $P_N = \{P_b \subset M \times M | b \in N\}$. Gale ja Shapley
  antavat ongelman esittelyn yhteydessä algoritmin joka ratkaisee
  ongelman ajassa $O(n^2)$. Ng osoittaa, että Galen ja Shapleyn
  algoritmi on suoritusajaltaan optimaalinen.

  Käytännön kannalta on usein tarpeellista muokata ongelmanasettelua
  niin, että järjestysrelaatioiden ei tarvitse kattaa koko vastakkaisen
  sukupuolen joukkoa, tai niissä on luvallista olla tasatilanteita.
  Molemmat näistä muunnoksista voidaan ratkaista ajassa $O(n^2)$, mutta
  yhdessä ne tekevät ongelmasta NP-täydellisen.
\end{abstract}

\mytableofcontents

\section{Johdanto}

Gale ja Shapley määrittelevät vakaan avioliiton ongelman (stable
marriage problem) artikkelissaan College Admissions and the Stability
of Marriage \cite{galeshapley62} jossa he esittävät ratkaisun
yliopistojen valintaongelmaan. Vakaan avioliiton ongelma on
yksinkertaistettu tilanne, jossa joukosta naisia ja miehiä pyritään
muodostamaan pareja noudattaen sekä miesten että naisten mieltymyksiä.
Gale ja Shapley määrittelevät vakauden (stability) ja optimaalisuuden
käsitteen kuvaamaan hyviä ratkaisuja ongelmaan.

Ensimmäisessä luvussa annan määritelmän vakaan avioliiton ongelmalle,
ratkaisun vakaudelle ja sen optimaalisuudelle. Seuraavassa luvussa
esittelen Galen ja Shapleyn esittelemän algoritmin ratkaisun
löytämiseksi. Saman luvun lopussa käyn läpi analyysin algoritmin
suoritusajasta. Kolmannessa luvussa esittelen tuloksen joka osoittaa
Galen ja Shapleyn algoritmin olevan suoritusajaltaan optimaalinen.

Päätösluvussaan Gale ja Shapley toteavat luomansa vakaan avioliiton
ongelman olevan hyvin teoreettinen ja kaukana alkuperäisestä
yliopistojen valintaongelmasta. Ongelman ja sen ratkaisun
sovellettavuutta voidaan kuitenkin parantaa luopumalla joistakin
alkuperäisen määrittelyn oletuksista. Neljäs luku käsittelee
muunnelmaa, jossa naisilla ja miehillä on mahdollisuus ilmaista
olevansa yhtä mieltyneitä kahteen tai useampaan vastakkaisen
sukupuolen edustajaan. Tämä muunnelma voidaan ratkaista muokkaamalla
Galen ja Shapleyn algoritmia suoritusajan pysyessä muuttumattomana
\cite{manlove02}. Viidennessä luvussa käsittelen muunnelmaa jossa
miehillä ja naisilla on mahdollisuus ilmoittaa etteivät he missään
tapauksessa halua muodostaa paria joidenkin vastakkaisen sukupuolen
edustajien kanssa. Myös tämän ongelman ratkaisuun on suoritusajaltaan
muuttumaton muunnelma Galen ja Shapleyn algoritmista
\cite{gusfield89}.

Mainitut kaksi muunnelmaa mahdollistavat niitä koskevien tulosten
soveltamisen moniin käytännön ongelmiin \cite{manlove02}. Kuudennessa
luvussa käsittelen muunnelmien yhdistelmää, jonka ratkaiseminen on
ongelmana NP-täydellinen \cite{manlove02}.

\section{Vakaan avioliiton ongelma}

Määritellään vakaan avioliiton ongelma seuraavasti. Olkoon $M$ joukko
miehiä ja $N$ joukko naisia. Olkoon lisäksi $P_M = \{P_a \subset N
\times N | a \in M\}$ ja $P_N = \{P_b \subset M \times M | b \in N\}$
joukot täydellisiä järjestysrelaatioita jotka kertovat mihin
järjestykseen mies $a$ (vastaavasti nainen $b$) sijoittaa vastakkaisen
sukupuolen edustajat. Kutsutaan näitä relaatioita
\emph{preferenssirelaatioiksi}. Jos siis $x,y \in M$ ja $xP_by$ pitää
nainen $b$ enemmän miehestä $x$ kuin $y$. Nyt nelikko $(M, N, P_M,
P_N)$ määrittelee vakaan avioliiton ongelman.

Nyt relaatiota $\mu \subset M \times N$ kutsutaan \emph{sijoitteluksi},
jos $\forall x \in M: \exists a \in N: (x, a) \in \mu$ ja vastaavasti
$\forall a \in N: \exists x \in M: (x, a) \in \mu$. Tapauksessa jossa
$|M| = |N|$ on $\mu$ bijektio, joten olkoon $\mu(x)$ miehen $x$ pari
sijoittelussa $\mu$ ja vastaavasti $\mu^{-1}(a)$ naisen $a$ pari.

Vakaan avioliiton ongelman ratkaiseminen tarkoittaa relaation $\mu$
määräämistä niin että se on vakaa. Sijoittelu on \emph{epävakaa}, jos
joillakin $x, y \in M$ ja $a, b \in N$ pätee, että $(x, a) \in \mu$ ja
$(y, b) \in \mu$ mutta $aP_yb$ ja $yP_ax$. Siis mies $y$ pitää enemmän
naisesta $a$ kuin paristaan $b$, ja nainen $a$ pitää enemmän miehestä
$y$ kuin paristaan $x$. Sijoittelua voitaisiin siis parantaa $y$:n ja
$a$:n kannalta määräämällä $(y, a) \in \mu$.

\section{Ratkaisu ajassa $\boldsymbol{\Theta(n^2)}$}

Jokaiseen vakaan avioliiton ongelmaan on olemassa vakaa ratkaisu
\cite{galeshapley62}. Gale ja Shapley todistavat tämän antamalla
seuraavanlaisen algoritmin vakaan sijoittelun löytämiseen.
Ensimmäisellä kierroksella jokainen mies kosii naista josta hän pitää
eniten. Naiset valitsevat alustavasti mahdollisista kosijoistaan sen
josta he pitävät eniten. Seuraavilla kierroksilla valitsematta jääneet
miehet kosivat listallaan seuraavana olevia naisia, ja naiset
valitsevat kosijoistaan ja mahdollisesta alustavasti valitusta
miehestä jälleen sen josta he pitävät eniten. Näin jatketaan kunnes
jokaista naista on kosittu ainakin kerran, jolloin muodostuneet parit
voidaan vahvistaa.

Jos jokaista naista on kosittu ainakin kerran, ei yksikään mies ole
tullut enää torjutuksi. Jos joku mies olisi tullut torjutuksi, olisi
joku nainen saanut useamman kuin yhden kosinnan, jolloin joku naisista
olisi jäänyt ilman kosintaa. Siispä algoritmi on määrännyt parin
jokaiselle miehelle ja naiselle kun jokaista naista on kosittu ainakin
kerran.

Algoritmin antama sijoittelu on vakaa \cite{galeshapley62}. Oletetaan,
että saatu sijoittelu on epävakaa ja on siis olemassa $x \in M$ ja $a
\in N$ joilla $(x, a) \notin \mu$, mutta $aP_x\mu(x)$ ja
$xP_a\mu^{-1}(a)$. Koska $x$ pitää enemmän naisesta $a$ kuin
paristaan, on hänen täytynyt kosia naista $a$ ennen pariaan. Koska $x$
ja $a$ eivät kuitenkaan ole pari, on naisen $a$ täytynyt torjua
kosinta. Nainen $a$ pitää siis enemmän paristaan kuin miehestä $x$.
Tämä on kuitenkin ristiriita. Siis saatu sijoittelu on vakaa.

Galen ja Shapleyn algoritmi ei vaadi, että naisten ja miesten joukot
ovat yhtämahtavat. Mikäli $|M| < |N|$ päättyy algoritmi kun $|M|$
kappaletta naisia on saanut kosinnan. Vastaavasti jos $|N| < |M|$,
päättyy algoritmi kun jokainen mies on tullut alustavasti valituksi
tai jokaisen naisen torjumaksi. \cite{galeshapley62}

\subsection{Pareto-optimaalisuus}

Galen ja Shapleyn algoritmin antama sijoittelu $\mu$ on miesten
kannalta \emph{heikosti Pareto-optimaalinen} \cite{gusfield89}. Ei
siis ole olemassa toista sijoittelua $\gamma$ jossa kaikilla $(x, a)
\in \gamma$ pätee, että $aP_x\mu(x)$. Vastaavasti voidaan määritellä,
että sijoittelu on heikosti Pareto-optimaalinen naisten kannalta.
Luonnollista on, että algoritmi antaa naisoptimaalisen sijoittelun,
kun kosijoiden rooli annetaan naisille.

\subsection{Yläraja $\boldsymbol{O(n^2)}$}

Gale ja Shapley kirjoittavat algoritmin päättyvän korkeintaan $n^2 -
2n + 2$ kierroksen jälkeen \cite{galeshapley62}. Asia esitetään
kuitenkin vain sivuhuomautuksena, eivätkä kirjoittajat ota kantaa
algoritmin varsinaiseen aikavaativuuteen. Kierrosten määrä ei anna
suoraan aihetta odottaa $O(n^2)$ aikavaativuutta, sillä yhden
kierroksen aikana voi tapahtua useita kosintoja. Ei siis ole selvää,
että yksi kierros on mahdollista suorittaa vakioajassa.

Gusfield ja Irving esittävät algoritmille muotoilun \cite{gusfield89}
jonka analysointi on alkuperäistä helpompaa. Siinä yhden kierroksen
aikana yksi mies kosii naista josta pitää eniten ja jota hän ei ole
vielä kosinut. Gusfiel ja Irving osoittavat että yksi kosinta voidaan
suorittaa vakioajassa \cite{gusfield89}. Nyt riittää tarkastella
kosintojen määrää joka tapauksessa $|M| = |N| = n$ on korkeintaan
$n^2$, sillä jokainen mies kosii jokaista naista korkeintaan kerran
\cite{gusfield89}. Tästä seuraa algoritmin suorituksen asymptoottinen
yläraja $O(n^2)$.

\subsection{Alaraja $\boldsymbol{\Omega(n^2)}$}

Ng osoittaa, että Galen ja Shapleyn algoritmi on asymptoottiselta
aikavaativuudeltaan optimaalinen \cite{cheng89}. Ngin päätuloksen
mukaan satunnaisesta mies-nainen -parista voidaan päätellä onko se
vakaa annetussa ongelmassa ajassa $\Omega(n^2)$. Tästä seuraa, että
vakaan avioliiton ongelman ratkaiseminen on asymptoottiselta
aikavaativuudeltaan $\Theta(n^2)$ \cite{cheng89}. Jos jokin algoritmi
löytäisi vakaan sijoittelun alle $\Theta(n^2)$ ajassa, päättelisi se
myös sijoitteluun kuuluvien parien vakauden alle $\Omega(n^2)$ ajassa
mikä olisi ristiriita. Toisin kuin Gusfieldin ja Irvinig analyysi
algoritmin ylärajasta, Ng olettaa, että naisten ja miesten joukot ovat
yhtämahtavat.

Ng analyysi tarkastelee sitä kuinka monta kertaa mikä tahansa vakaan
avioliiton ongelmaa ratkaiseva algorimi joutuu tarkastelemaan
syötteenään saatua ongelman kuvausta. Ng aloittaa kanonisesta
ongelmasta jossa tutkittava pari on vakaa. Sitten hän esittää
menetelmän jolla voidaan muodostaa tästä ongelmasta muunnelmia joissa
tutkittava pari ei ole vakaa. Nyt tunnistaakseen onko pari vakaa
syötteenä annetussa ongelmassa, tulee algoritmin kyetä erottamaan
kanoninen ongelma siitä luoduista muunnelmista. Ng osoittaa tähän
tarvittavan ainakin $\Omega(n^2)$ ongelman kuvauksen tarkastelua.
\cite{cheng89}

\section{Osittaiset preferenssirelaatiot}

Galen ja Shapleyn määrittelemässä vakaan avioliiton ongelmassa
molemmat sukupuolet määrittelevät kiinnostuksensa kaikista
vastakkaisen sukupuolen henkilöistä. Käytännön sovelluksissa tämä ei
kuitenkaan ole aina haluttua. Esimerkiksi oppilaitosten valinnoissa
hakijat eivät ole halukkaita opiskelemaan missä tahansa
oppilaitoksessa eivätkä oppilaitokset halua ottaa vastaan ketä tahansa
hakijaa.

Näin syntyy muunnelma vakaan avioliiton ongelmasta jossa
preferenssirelaatioiden ei tarvitse olla täydellisiä. Ne eivät siis
välttämättä anna järjestystä kaikille vastakkaisen sukupuolen
henkilöille. Lisäksi sijoittelulle $\mu$ tulee päteä, että jos $x \in
M$, $a \in N$ ja $(x, a) \in \mu$ niin $(\exists b \in N: (a, b) \in
P_x$ tai $(b, a) \in P_x)$ ja $(\exists y \in M: (x, y) \in P_a$ tai
$(y, x) \in P_a)$. Siis jos mies $x$ ja nainen $a$ ovat pari, ovat
nainen ja mies esittäneet mieltymyksensä toisistaan.

Tästä seuraa, että saatu sijoittelu voi olla osittainen sillä jokainen
mies ja nainen eivät välttämättä saa itselleen paria. Tästä syystä on
tarpeen muotoilla heikompi versio vakaudesta. Sijoittelu on
\emph{heikosti epävakaa}, jos on olemassa $x \in M$ ja $a \in N$ ja
seuraavat ehdot ovat voimassa \cite{gusfield89}:
\[
\text{1. }(x, a) \notin \mu\text{, mutta molemmat ovat esittäneet
  mieltymyksen toisiinsa}
\]
\[
\text{2. }\not\exists b \in N \text{ jolla }(x, b) \in \mu\text{, tai jos
}\exists b \in N: (x, b) \in \mu \text{, niin }aP_xb
\]
\[
\text{3. }\not\exists y \in M\text{ jolla }(y, a) \in \mu\text{, tai
  jos }\exists y \in M: (y, b) \in \mu\text{, niin }xP_by
\]

Myös Pareto-optimaalisuus voidaan laajentaa koskemaan osittaisilla
järjestysrelaatioilla saatua sijoittelua. Jokainen mies pitää
parempana sijoittelua jossa hänellä on pari, kuin sijoittelua jossa
hänellä ei ole paria. \cite{gusfield89}

\section{Ei-antisymmetriset preferenssirelaatiot}

Monissa käytännön sovelluksissa ei ole aina haluttua määritellä
järjestystä kaikkien vastakkaisen osapuolen toimijoiden välille.
Esimerkiksi oppilaitosten valinnoissa jonkin rajan alle jääneistä
hakijoista valinta saatetaan tehdä esimerkiksi arpomalla. Jaettaessa
toimistoja työtekijöille voi työntekijällä olla vain muutama
vaihtoehto johon hän erityisesti haluaa. Erona osittaisiin
preferenssirelaatioihin on kuitenkin se, että toimijat ovat kuitenkin
valmiita muodostamaan parin kenen tahansa vastapuolen toimijan kanssa.

Näin saadussa muunnelmassa preferenssirelaatiot eivät ole
antisymmetrisiä eivätkä siten myöskään järjestysrelaatioita. Voi siis
olla niin, että jos $x \in M$, $a,b \in N$ ja $a \neq b$, niin$aP_Xb$
ja $bP_xa$ ovat voimassa yhtä aikaa. Muunnelman mukaiset ongelmat
voidaan kuitenkin ratkaista alkuperäistä Galen ja Shapleyn algoritmia
käyttäen, jos tasatilanteet ratkaistaan satunnaisesti
\cite{gusfield89}.

Käytännön ongelmissa tasatilanteiden ratkaiseminen arvalla on usein
hyväksyttävää. Siitä seuraa kuitenkin, että algoritmi saattaa antaa
eri suorituskerroilla eri tuloksen. Nyt kaikkia algoritmin tuottamia
sijoitteluja voisi luonnehtia heikosti Pareto-optimaalisiksi, mutta
käsitteen määrittelyä täytyy muuttaa, sillä se ei salli useita
optimaalisia sijoitteluja.

Olkoon siis ei-antisymmetristen preferenssirelaatioiden tapauksessa
sijoittelu $\mu$ \emph{heikosti Pareto-optimaalinen} jos ei ole
olemassa toista sijoittelua $\gamma$ jossa kaikilla $(x, a) \in
\gamma$ pätee, että $aP_x\mu(x)$ ja $\mu(x)\not P_xa$. Siis
sijoittelussa $\gamma$ kaikki miehet pitäisivät aidosti enemmän
paristaan kuin sijoittelussa $\mu$.

\begin{thebibliography}{XXX99}

\bibitem[GaS62]{galeshapley62}
  D. Gale, L. S. Shapley.
  College Admissions and the Stability of Marriage.
  \emph{The American Mathematical Monthly, 69, 1 (1962)}

\bibitem[MII02]{manlove02}
  David F. Manlove, Robert W. Irving, Kazuo Iwama, Shuichi Miyazaki,
  Yasufumi Morita.
  Hard variants of stable marriage.
  \emph{Theoretical Computer Science, 276, (2002), sivut 261-279}

\bibitem[GuI89]{gusfield89}
  D. Gusfield, Robert W. Irving.
  The Stable Marriage Problem: Structure and Algorithms.
  \emph{MIT Press, Cambridge, MA, 1989}

\bibitem[Che89]{cheng89}
  Cheng Ng.
  Lower Bounds for the Stable Marriage Problem and its Variants.
  \emph{30th Annual Symposium on Foundations of Computer Science,
    (1989), sivut 129-133}

\end{thebibliography}
\end{document}
